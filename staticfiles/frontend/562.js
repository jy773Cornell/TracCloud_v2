"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[562],{9518:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(7294),r=a(6914),l=a(2206),i=a(2658),o=a(4680);function d(e){return n.createElement(l.ZP,{open:Boolean(e.anchorEl),anchorEl:e.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},n.createElement(o.Z,{sx:{p:1,maxWidth:400}},n.createElement(i.Z,{variant:"body1"},e.msg),n.createElement(r.Z,{onClick:()=>{"delete"===e.type?(e.setAnchorEl(null),e.onDeleteClicked(e.params)):"update"===e.type&&(e.setAnchorEl(null),e.onSaveClicked())},color:"primary"},"Yes"),n.createElement(r.Z,{onClick:()=>e.setAnchorEl(null),color:"secondary"},"No")))}},4311:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(7294),r=a(6447),l=a(7608),i=a(2288);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o.apply(this,arguments)}const d=n.forwardRef((function(e,t){return n.createElement(i.Z,o({elevation:6,ref:t,variant:"filled"},e))}));function s(e){const t=(t,a)=>{"clickaway"!==a&&e.setOpen(!1)};return n.createElement(r.Z,{spacing:2,sx:{width:"100%"}},n.createElement(l.Z,{open:e.open,autoHideDuration:6e3,onClose:t},(()=>{switch(e.tag){case"success":return n.createElement(d,{onClose:t,severity:"success",sx:{width:"100%"}},e.msg);case"error":return n.createElement(d,{onClose:t,severity:"error",sx:{width:"100%"}},e.msg);case"warning":return n.createElement(d,{onClose:t,severity:"warning",sx:{width:"100%"}},e.msg);default:return null}})()))}},1562:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var n=a(7294),r=a(7484),l=a.n(r),i=a(4680),o=a(6867),d=a(6540),s=a(7957),c=a(1733),u=a(6818),m=a(4510),h=a(9628),p=a(7171),E=a(7794),f=a(5295),v=a(2643),g=a(5725),b=a(6694),Z=a(5116),y=a(4212),C=a(6914),w=a(3264),x=a(5137);const Y=(0,w.Z)(C.Z)((()=>({margin:"15px 15px",backgroundColor:x.Z[500],"&:hover":{backgroundColor:x.Z[700]}})));var _=a(4311),O=a(2176),S=a(6132),k=a(853),P=a(4482),D=a(7406),M=a(3306),j=a(9518),I=a(720),N=a(9925),A=a(6189),T=a(3250);function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},H.apply(this,arguments)}const U=200,R=350,$=["crop","site","hr_area","area_unit","rows","planting_date","bloom_date","har_datetime","operator","tracing_no"],q=["Row","Hole Code#","Section","Block"];function F(){return n.createElement(O.D,null,n.createElement(S.S,null),n.createElement(k.M,null),n.createElement(P.L,null),n.createElement(D.Zh,null))}function G({cropOptions:e,siteOptions:t,siteUnitOptions:a,fieldValues:r,formData:i,columns:o,handleAddInputChange:d,showAddModal:s,setShowAddModal:c,setIsSave:u,inputError:m,updateInputError:w,refreshRecord:x,setRefreshRecord:Y}){const _=n.createElement(h.Z,{fontSize:"small"}),O=n.createElement(p.Z,{fontSize:"small"});return n.createElement(E.Z,{open:s,onClose:()=>c(!1),sx:{display:"flex",justifyContent:"center",alignItems:"center"}},n.createElement(f.Z,{sx:{width:800}},n.createElement(v.Z,null,n.createElement(g.ZP,{container:!0,justifyContent:"center",spacing:2},n.createElement(g.ZP,{item:!0,xs:12,sx:{textAlign:"center"}},n.createElement("h1",null,"Add Harvest Record")),n.createElement(g.ZP,{item:!0,xs:6},n.createElement(b.Z,{value:r[$[0]],options:e,onChange:(e,t)=>{d(e,t,$[0])},renderInput:e=>n.createElement(Z.Z,H({},e,{required:!0,variant:"outlined",placeholder:"Crop (Variety, Growth Stage)",label:o[1].headerName,error:m[$[0]]}))})),n.createElement(g.ZP,{item:!0,xs:6},n.createElement(b.Z,{multiple:!0,value:r[$[1]],getOptionLabel:e=>e.label,options:t,disableCloseOnSelect:!0,onChange:(e,t)=>{d(e,t,$[1])},renderOption:(e,t,{selected:a})=>n.createElement("li",e,n.createElement(y.Z,{icon:_,checkedIcon:O,style:{marginRight:8},checked:a}),t.label),renderInput:e=>n.createElement(Z.Z,H({},e,{required:!0,variant:"outlined",label:o[2].headerName,error:m[$[1]]}))})),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(Z.Z,{variant:"outlined",fullWidth:!0,required:!0,type:"number",inputProps:{step:.01},label:o[3].headerName,error:m[$[2]],onChange:e=>{d(e,e.target.value,$[2])}})),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(b.Z,{value:r[$[3]],options:a,onChange:(e,t)=>{d(e,t,$[3])},renderInput:e=>n.createElement(Z.Z,H({},e,{required:!0,variant:"outlined",label:"Area Unit",error:m[$[3]]}))})),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(Z.Z,{variant:"outlined",type:"number",fullWidth:!0,label:o[4].headerName,onChange:e=>{d(e,e.target.value,$[4])}})),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(I._,{dateAdapter:N.y},n.createElement(A.M,{variant:"outlined",label:o[5].headerName,value:l()(r[$[5]]),onChange:e=>{d(e,l()(e).format("YYYY-MM-DD"),$[5])},sx:{width:"100%"}}))),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(I._,{dateAdapter:N.y},n.createElement(A.M,{variant:"outlined",label:o[6].headerName,value:l()(r[$[6]]),onChange:e=>{d(e,l()(e).format("YYYY-MM-DD"),$[6])},sx:{width:"100%"}}))),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(I._,{dateAdapter:N.y},n.createElement(T.x,{variant:"outlined",label:o[7].headerName,value:l()(r[$[7]]),onChange:e=>{d(e,l()(e).format("YYYY-MM-DD HH:mm"),$[7])},sx:{width:"100%"}}))),n.createElement(g.ZP,{item:!0,xs:4},n.createElement(Z.Z,{variant:"outlined",required:!0,fullWidth:!0,label:o[8].headerName,error:m[$[8]],onChange:e=>{d(e,e.target.value,$[8])}})),n.createElement(g.ZP,{item:!0,xs:8},n.createElement(Z.Z,{variant:"outlined",fullWidth:!0,label:o[9].headerName,onChange:e=>{d(e,e.target.value,$[9])}})),n.createElement(g.ZP,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},n.createElement(C.Z,{variant:"contained",color:"success",onClick:()=>{0===Object.keys(r).filter((e=>e!==$[4]&&e!==$[9])).filter((e=>0===r[e].length)).length?async function(){const e=function(e){const{crop:t,site:a,area_unit:n,...r}=e;return{crop_id:t,site_list:a,area_unit_id:n,...r}}(i);console.log(e);const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};await fetch("/api/operation/harvest/create/",t).then((e=>{e.ok&&(u(!0),c(!1),Y(~x))}))}():w()}},"Save")),n.createElement(g.ZP,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},n.createElement(C.Z,{variant:"contained",color:"secondary",onClick:()=>c(!1)},"Cancel"))))))}function W(e){const t=e.uid,[a,r]=(0,n.useState)([]),[h,p]=(0,n.useState)([]),[E,f]=(0,n.useState)([]),[v,g]=(0,n.useState)([]),[y,C]=(0,n.useState)([]),[w,x]=(0,n.useState)([]),[O,S]=(0,n.useState)([]),[k,P]=(0,n.useState)([]),[D,W]=(0,n.useState)({}),[z,B]=(0,n.useState)({}),[J,V]=(0,n.useState)(!1),[L,K]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(!1),[ee,te]=(0,n.useState)(!1),[ae,ne]=(0,n.useState)(!0),[re,le]=(0,n.useState)([]),[ie,oe]=(0,n.useState)(null),[de,se]=(0,n.useState)(null),[ce,ue]=(0,n.useState)(null),[me,he]=(0,n.useState)(!1);async function pe(e){await fetch("/api/crop/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{p(e.data)}))}))}async function Ee(e){await fetch("/api/site/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{f(ge(e.data))}))}))}async function fe(e){await fetch("/api/operation/harvest/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{r(e.data)}))}))}async function ve(){await fetch("/api/unit/",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{g(e.data)}))}))}const ge=e=>{let t=[];for(let a=0;a<e.length;a++){let n={};n={...e[a]},delete n.children,t.push(n),e[a].children&&(t=t.concat(ge(e[a].children)))}return t},be=e=>{if("string"!=typeof e)return null;const t=e.match(/(\d+\.\d+)|(\d+)/);return t?t[0]:null},Ze=()=>{le(Object.fromEntries($.map((e=>[e,!1]))))},ye=()=>{Object.keys(z).forEach((e=>{0===z[e].length?le((t=>({...t,[e]:!0}))):le((t=>({...t,[e]:!1})))}))},Ce=()=>{if(0===Object.keys(z).filter((e=>e!==$[4]&&e!==$[9])).filter((e=>0===z[e].length)).length){!async function(){const e=function(e){const{crop:t,site:a,area_unit:n,...r}=e;return{crop_id:t,site_id:a,area_unit_id:n,...r}}(D);console.log(e);const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};await fetch("/api/operation/harvest/update/",t).then((e=>{e.ok&&(X(!0),oe(null),he(~me))}))}();const e=k.findIndex((e=>e.id===z.id));P([...k.slice(0,e),z,...k.slice(e+1)])}else ye()},we=e=>{!async function(e){const a={user:t,arid:e};console.log(a);const n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};await fetch("/api/operation/harvest/delete/",n).then((e=>{e.ok&&(te(!0),he(~me))}))}(e.id);const a=k.findIndex((t=>t.id===e.id));P([...k.slice(0,a),...k.slice(a+1)])},xe=(e,t,a)=>{a===$[0]?(B({...z,[a]:t,[$[1]]:[]}),W({...D,[a]:t.id,[$[1]]:[]})):a===$[1]?(B({...z,[a]:t}),W({...D,[a]:t.map((e=>e.id))})):a===$[3]?(B({...z,[a]:t}),W({...D,[a]:t.id})):(B({...z,[a]:t}),W({...D,[a]:t}))},Ye=(e,t,a)=>{a===$[0]?(B({...z,[a]:t,[$[1]]:""}),W({...D,[a]:t.id,[$[1]]:null})):[$[1],$[3]].includes(a)?(B({...z,[a]:t}),W({...D,[a]:t.id})):(B({...z,[a]:t}),W({...D,[a]:t}))},_e=[{field:"operations",headerName:"Operations",sortable:!1,width:100,disableColumnMenu:!0,disableClickEventBubbling:!0,renderCell:e=>ie!==e.id?n.createElement(n.Fragment,null,n.createElement(o.Z,{onClick:()=>(e=>{const t=a.find((t=>t.hrid===e.id)),n=Object.keys(e.row).reduce(((t,a)=>(t[a]=null===e.row[a]?"":e.row[a],t)),{});W({hrid:e.id,crop:t.crop}),B({...n,[$[3]]:t.area_unit}),oe(e.id),Ze()})(e)},n.createElement(s.Z,null)),n.createElement(o.Z,{onClick:t=>{se(t.currentTarget),ue(e.id)}},n.createElement(c.Z,null)),ce===e.id&&n.createElement(j.Z,{anchorEl:de,setAnchorEl:se,onDeleteClicked:we,params:e,msg:"Delete this record?",type:"delete"})):n.createElement(n.Fragment,null,n.createElement(o.Z,{onClick:t=>{se(t.currentTarget),ue(e.id)}},n.createElement(u.Z,null)),n.createElement(o.Z,{onClick:()=>(oe(null),void Ze())},n.createElement(m.Z,null)),ce===e.id&&n.createElement(j.Z,{anchorEl:de,setAnchorEl:se,onSaveClicked:Ce,params:e,msg:"Update this record?",type:"update"}))},{field:"crop",headerName:"Crop",sortable:!1,width:R,renderCell:(e,t=e.id)=>n.createElement(b.Z,{options:y,disableClearable:!0,readOnly:ie!==t,value:ie===t?z[$[0]]:e.value,onChange:(e,t)=>{Ye(0,t,$[0])},renderInput:e=>ie!==t?n.createElement(Z.Z,H({},e,{variant:"standard",InputProps:{disableUnderline:!0},sx:{width:R}})):n.createElement(Z.Z,H({},e,{variant:"standard",sx:{width:R-20},error:re[$[0]]}))})},{field:"site",headerName:"Site",sortable:!1,width:R,renderCell:(e,t=e.id)=>n.createElement(b.Z,{options:w,disableClearable:!0,readOnly:ie!==t,value:ie===t?z[$[1]]:e.value,onChange:(e,t)=>{Ye(0,t,$[1])},renderInput:e=>ie!==t?n.createElement(Z.Z,H({},e,{variant:"standard",InputProps:{disableUnderline:!0},sx:{width:R}})):n.createElement(Z.Z,H({},e,{variant:"standard",sx:{width:R-20},error:re[$[1]]}))})},{field:"hr_area",headerName:"Harvest Area",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(n.Fragment,null,n.createElement(Z.Z,{variant:"standard",value:be(z[$[2]]),sx:{width:U/3},type:"number",inputProps:{step:.01},onChange:e=>{Ye(0,e.target.value,$[2])},error:re[$[2]]}),n.createElement(b.Z,{options:O,disableClearable:!0,value:z[$[3]],onChange:(e,t)=>{xe(0,t,$[3])},renderInput:e=>n.createElement(Z.Z,H({},e,{required:!0,variant:"standard",sx:{width:2*U/3},error:re[$[3]]}))}))},{field:"rows",headerName:"Rows",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(Z.Z,{variant:"standard",value:be(z[$[4]]),sx:{width:U},type:"number",onChange:e=>{Ye(0,e.target.value,$[4])},error:re[$[4]]})},{field:"planting_date",headerName:"Planting Date",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(I._,{dateAdapter:N.y},n.createElement(A.M,{variant:"standard",value:l()(z[$[5]]),sx:{width:U-20},slotProps:{textField:{variant:"standard"}},onChange:e=>{Ye(0,l()(e).format("YYYY-MM-DD"),$[5])}}))},{field:"bloom_date",headerName:"Bloom Date",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(I._,{dateAdapter:N.y},n.createElement(A.M,{variant:"standard",value:l()(z[$[6]]),sx:{width:U-20},slotProps:{textField:{variant:"standard"}},onChange:e=>{Ye(0,l()(e).format("YYYY-MM-DD"),$[6])}}))},{field:"har_datetime",headerName:"Harvest Datetime",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(I._,{dateAdapter:N.y},n.createElement(T.x,{variant:"standard",value:l()(z[$[7]]),sx:{width:U-20},slotProps:{textField:{variant:"standard"}},onChange:e=>{Ye(0,l()(e).format("YYYY-MM-DD HH:mm"),$[7])}}))},{field:"operator",headerName:"Operator",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(Z.Z,{variant:"standard",value:z[$[8]],sx:{width:U},onChange:e=>{Ye(0,e.target.value,$[8])},error:re[$[8]]})},{field:"tracing_no",headerName:"Tracking No.",sortable:!1,width:U,renderCell:(e,t=e.id)=>ie!==t?n.createElement(Z.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):n.createElement(Z.Z,{variant:"standard",value:z[$[9]],sx:{width:U},onChange:e=>{Ye(0,e.target.value,$[9])}})},{field:"update_time",headerName:"Update Time",sortable:!1,width:U}],Oe={cropOptions:y,siteOptions:w,siteUnitOptions:O,fieldValues:z,formData:D,columns:_e,handleAddInputChange:xe,showAddModal:L,setShowAddModal:K,setIsSave:X,inputError:re,updateInputError:ye,refreshRecord:me,setRefreshRecord:he},Se={open:Q,setOpen:X,msg:"Harvest record is uploaded successfully!",tag:"success"},ke={open:ee,setOpen:te,msg:"Harvest record has been deleted!",tag:"success"};return(0,n.useEffect)((()=>{(async()=>{await Promise.all([ve(),pe(t),Ee(t)]),await fe(t)})(),Ze(),V(!0)}),[]),(0,n.useEffect)((()=>{C(h.map((e=>({label:`${e.crop} (${e.variety}, ${e.growth_stage})`,id:e.cid}))))}),[h]),(0,n.useEffect)((()=>{(e=>{const t=E.filter((e=>q.includes(e.type)));let a=[];t.filter((t=>t.crop.cid===e)).map((t=>{let n=t,r=n.name;const l=n.sid;for(;n.parent;)n=E.find((e=>e.sid===n.parent)),r=`${n.name} - ${r}`;a.push({label:r,cid:e,id:l})})),x(a)})(D[$[0]])}),[D[$[0]]]),(0,n.useEffect)((()=>{S(v.filter((e=>"site"===e.usage)).map((e=>({label:e.name,id:e.unitid}))))}),[v]),(0,n.useEffect)((()=>{ae?P(a.map((e=>(e=>{const t=h.find((t=>t.cid===e.crop));let a=E.find((t=>t.sid===e.site)),n=a.name;for(;a.parent;)a=E.find((e=>e.sid===a.parent)),n=`${a.name} - ${n}`;return{id:e.hrid,crop:`${t.crop} (${t.variety}, ${t.growth_stage})`,site:n,hr_area:`${e.hr_area} ${e.area_unit}`,rows:e.rows,planting_date:e.planting_date,bloom_date:e.bloom_date,har_datetime:e.har_datetime,operator:e.operator,tracing_no:e.tracing_no,update_time:e.update_time}})(e)))):console.log(1)}),[a]),(0,n.useEffect)((()=>{J&&fe(t)}),[me]),n.createElement("div",null,n.createElement(Y,{variant:"contained",startIcon:n.createElement(d.Z,null),onClick:()=>(W({user_id:t,[$[5]]:l()().subtract(1,"year").format("YYYY-MM-DD"),[$[6]]:l()().subtract(6,"month").format("YYYY-MM-DD"),[$[7]]:l()().format("YYYY-MM-DD HH:mm")}),B((e=>({...Object.fromEntries($.map(((e,t)=>[e,1===t?[]:""]))),[$[5]]:l()().subtract(1,"year").format("YYYY-MM-DD"),[$[6]]:l()().subtract(6,"month").format("YYYY-MM-DD"),[$[7]]:l()().format("YYYY-MM-DD HH:mm")}))),oe(null),K(!0),void Ze())},"Add Harvest Record"),n.createElement(i.Z,{style:{height:900,margin:"0px 15px"}},n.createElement(M._,{columns:_e,rows:k,disableRowSelectionOnClick:!0,disableClickEdit:!0,rowSelection:!1,slots:{toolbar:F}})),n.createElement(G,Oe),n.createElement(_.Z,Se),n.createElement(_.Z,ke))}}}]);