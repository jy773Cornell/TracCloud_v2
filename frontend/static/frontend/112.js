"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[112],{8576:(e,t,n)=>{n.d(t,{K:()=>o});var r=n(1504);const o=n.n(r)().createContext({notificationFetch:!1,toggleNotificationFetch:()=>{}})},112:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(1504),o=n(5800),c=n(4464),a=n(3680),i=n(7380),l=n(9276),s=n(68),d=n(8272),m=n(4180),p=n(4632),u=n(6968),f=n(6060),h=n(2205);(0,f.c)(h.cp)({width:200,color:"#9ad9bd",display:"flex",flexShrink:0});const y=(0,f.c)("div")({display:"flex",alignItems:"center",justifyContent:"center",height:64,fontSize:25});var E=n(7808),g=n(4568),w=n(5420),k=n(2528),C=n(3376),b=n(3562),x=n(8576);function v(e){const{notificationFetch:t,toggleNotificationFetch:n}=(0,r.useContext)(x.K),[f,h]=r.useState([]),[v,T]=r.useState(""),[S,_]=r.useState([]);async function U(t,n){await fetch("/message/report/list/get?author_id="+t+"&recipient_id="+n,{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>{t.ok&&t.json().then((t=>{h(t.report_messages),T("Client"===e.relationType?t.users.author:t.users.recipient)}))}))}const j=async t=>{t.is_read||"Client"!==e.relationType||(await async function(e){const t={mid:e};console.log(t);const n={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,k.U$)("csrftoken")},body:JSON.stringify(t)};await fetch("/message/read",n).then((t=>{t.ok&&(e=>{const t=f.map((t=>t.mid===e?{...t,is_read:!0}:t));h(t)})(e)}))}(t.mid),n())};return(0,r.useEffect)((()=>{e.selectedUser&&("Client"===e.relationType?U(e.selectedUser,e.employerID):U(e.employerID,e.selectedUser))}),[e.selectedUser,e.refreshRecord]),(0,r.useEffect)((()=>{f.length>0&&("Client"===e.relationType?T(f[0].author):T(f[0].recipient))}),[f]),r.createElement(u.c,{style:{height:"calc(3/4 * 5/6 * 100vh)",marginRight:"16px",marginLeft:"Client"===e.relationType?"16px":"0px",marginTop:"16px",overflow:"auto"},sx:{border:"1px solid",borderColor:"divider"}},r.createElement(y,null,"Reports History with ",v),r.createElement(w.c,null),r.createElement(o.c,{sx:{width:"100%",bgcolor:"background.paper"}},f.map((t=>r.createElement(r.Fragment,{key:t.mid},r.createElement(c.c,{onClick:()=>{(e=>{const t=S.includes(e);_(t?S.filter((t=>t!==e)):[...S,e])})(t.mid),j(t)}},r.createElement(a.c,null,r.createElement(E.c,{color:"error",variant:"dot",invisible:"Client"!==e.relationType||t.is_read},r.createElement(d.c,null))),r.createElement(i.c,{primary:t.subject,secondary:t.create_time,sx:{overflowWrap:"break-word",wordWrap:"break-word"}}),S.includes(t.mid)?r.createElement(m.c,null):r.createElement(p.c,null)),r.createElement(l.c,{in:S.includes(t.mid),timeout:"auto",unmountOnExit:!0},r.createElement(o.c,{component:"div",disablePadding:!0},t.reports.map((e=>r.createElement(g.cp,{key:e.rid,sx:{pl:4,display:"flex",alignItems:"center"}},r.createElement(a.c,null,r.createElement(s.c,null)),r.createElement(i.c,{primary:e.name}),r.createElement(b.c,{onClick:()=>{return t=e.user_id,n=e.rid,void async function(e,t){const n={user_id:e,rid:t},r={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,k.U$)("csrftoken")},body:JSON.stringify(n)};try{const e=await fetch("/media/report/download/",r);if(!e.ok)throw new Error("Server response was not ok.");const t=e.headers.get("Content-Disposition");let n="downloaded_file";if(t){const e=t.match(/filename="([^"]+)"/);e&&e[1]&&(n=e[1])}const o=await e.arrayBuffer(),c=new Blob([o]),a=URL.createObjectURL(c),i=document.createElement("a");i.href=a,i.download=n,document.body.appendChild(i),i.click(),i.remove()}catch(e){console.error("Error downloading the file:",e)}}(t,n);var t,n}},r.createElement(C.c,null))))))),r.createElement(w.c,null))))))}}}]);