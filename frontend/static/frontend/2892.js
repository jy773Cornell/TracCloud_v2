"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2892],{2892:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(1504),r=n(3964),l=n(3604),o=n(3184),s=n(4660),c=n(1940),i=n(2528);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}const p=(0,a.lazy)((()=>Promise.all([n.e(5156),n.e(9128)]).then(n.bind(n,7600)))),u=(0,a.lazy)((()=>n.e(7612).then(n.bind(n,7612)))),m=(0,a.lazy)((()=>Promise.all([n.e(5156),n.e(9730),n.e(7232),n.e(8472)]).then(n.bind(n,6072)))),h=(0,a.lazy)((()=>Promise.all([n.e(5156),n.e(4896),n.e(232),n.e(2588),n.e(3916),n.e(3920)]).then(n.bind(n,4456))));function y({uid:e,sprayData:t,sprayCardSelected:n,sprayOptions:y,setAssignSprayCard:f,refreshRecord:g,setRefreshRecord:E,privilege:S}){const[v,b]=a.useState([]),[w,C]=a.useState([]),[O,_]=a.useState([]),[k,N]=a.useState([]),[T,P]=a.useState([]),[x,R]=a.useState([]),[J,j]=a.useState([]),[W,F]=a.useState([]),[A,I]=a.useState([]),[$,D]=a.useState([]),[U,X]=(0,a.useState)(!1),[z,M]=(0,a.useState)(!1),[B,G]=(0,a.useState)(null),[L,V]=(0,a.useState)(null),[q,H]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),Y=(e,t)=>{"return"===t?G(e.currentTarget):"withdraw"===t&&V(e.currentTarget)},Z=e=>{"return"===e?G(null):"withdraw"===e&&V(null)},ee={open:U,setOpen:X,msg:"Spray Card Process Returned Successfully.",tag:"success"},te={open:z,setOpen:M,msg:"Spray Card Process Withdrew Successfully.",tag:"success"},ne={uid:e,sprayData:t,sprayOptions:y,sprayCardContents:v,refreshRecord:g,editSprayCard:K,setEditSprayCard:Q,setRefreshRecord:E,setAssignSprayCard:f,sprayCardSelected:n,privilege:S},ae={uid:e,sprayData:t,sprayOptions:y,sprayCardContents:v,refreshRecord:g,completeSprayCard:q,setCompleteSprayCard:H,setRefreshRecord:E,sprayCardSelected:n};return(0,a.useEffect)((()=>{(null==n?void 0:n.scpid)&&async function(e){await fetch("/workflow/spraycard/content/get/?scpid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{b(e.data)}))}))}(null==n?void 0:n.scpid)}),[n]),(0,a.useEffect)((()=>{(()=>{var e,t;const n=[...new Map(v.map((e=>[JSON.stringify(e.chemical_purchase),e.chemical_purchase]))).values()];let a=[];for(let e=0;e<n.length;e++)a.push(v.find((t=>JSON.stringify(t.chemical_purchase)===JSON.stringify(n[e]))).application_rate);let r=JSON.parse(JSON.stringify(n));for(let e=0;e<r.length;e++)r[e].label=r[e].label+" | "+a[e]+" "+r[e].unit;N(r);let l=[];for(let e=0;e<n.length;e++)l.push(v.find((t=>JSON.stringify(t.chemical_purchase)===JSON.stringify(n[e]))).decision_support);j(l);let o=[];for(let e=0;e<n.length;e++){let t=v.filter((t=>JSON.stringify(t.chemical_purchase)===JSON.stringify(n[e]))).reduce(((e,t)=>e+parseFloat(t.total_amount)),0);o.push(t)}P(o);let s=[];for(let e=0;e<n.length;e++){let t=v.filter((t=>JSON.stringify(t.chemical_purchase)===JSON.stringify(n[e]))).reduce(((e,t)=>e+parseFloat(t.total_cost)),0);s.push(t)}R(s);const c=[...new Map(v.map((e=>[JSON.stringify(e.crop),e.crop]))).values()];F(c);let i=[];for(let e=0;e<c.length;e++)i.push(v.find((t=>JSON.stringify(t.crop)===JSON.stringify(c[e]))).target);I(i);const d=[...new Map(v.map((e=>[JSON.stringify(e.site),e.site]))).values()];D(d),_((null===(e=v[0])||void 0===e?void 0:e.gallons_water_rate)||""),C((null===(t=v[0])||void 0===t?void 0:t.responsible_person)||"")})()}),[v]),a.createElement(a.Fragment,null,a.createElement(r.cp,{container:!0,justifyContent:"center",spacing:3},["completed","withdrew"].includes(null==n?void 0:n.state)?null:a.createElement(a.Fragment,null,a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{onClick:()=>{f(!0)},disabled:!S.spraycard_a},"Assign")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{"aria-describedby":"return-popover",disabled:!((null==n?void 0:n.holder_id)===e&&(null==n?void 0:n.holder_id)!==(null==n?void 0:n.owner_id)&&"assigned"===(null==n?void 0:n.state)),onClick:e=>Y(e,"return")},"Return"),a.createElement(u,{id:"return-popover",open:Boolean(B),anchorEl:B,onClose:()=>Z("return"),action:()=>{!async function(e,t){const n={spray_card_id:e,holder_id:t};console.log(n);const a={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,i.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/workflow/spraycard/return/",a).then((e=>{e.ok&&(X(!0),E(~g))}))}(n.scpid,e)},buttonText:"Return to the last assigner?"})),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{disabled:(console.log("running"),!((null==n?void 0:n.holder_id)===e&&"assigned"===(null==n?void 0:n.state))),onClick:()=>{(async function(e,t){const n={spray_card_id:e,holder_id:t};console.log(n);const a={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,i.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/workflow/spraycard/start/",a).then((e=>{e.ok&&E(~g)})).catch((e=>{}))})(n.scpid,e)}},"Start")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{disabled:!((null==n?void 0:n.holder_id)===e&&"in progress"===(null==n?void 0:n.state)),onClick:()=>{(async function(e,t){const n={spray_card_id:e,holder_id:t};console.log(n);const a={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,i.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/workflow/spraycard/pause/",a).then((e=>{e.ok&&E(~g)})).catch((e=>{}))})(n.scpid,e)}},"Pause")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{disabled:!((null==n?void 0:n.holder_id)===e&&"paused"===(null==n?void 0:n.state)),onClick:()=>{(async function(e,t){const n={spray_card_id:e,holder_id:t};console.log(n);const a={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,i.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/workflow/spraycard/resume/",a).then((e=>{e.ok&&E(~g)})).catch((e=>{}))})(n.scpid,e)}},"Resume")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{disabled:!((null==n?void 0:n.holder_id)===e&&"in progress"===(null==n?void 0:n.state)),onClick:()=>{H(!0)}},"Complete")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{disabled:!((null==n?void 0:n.owner_id)===e&&(null==n?void 0:n.holder_id)===(null==n?void 0:n.owner_id)),onClick:()=>{Q(!0)}},"Edit")),a.createElement(r.cp,{item:!0,xs:2.4},a.createElement(c.c,{"aria-describedby":"withdraw-popover",disabled:!((null==n?void 0:n.owner_id)===e&&"archived"!==(null==n?void 0:n.state)),onClick:e=>Y(e,"withdraw")},"Withdraw"),a.createElement(u,{id:"withdraw-popover",open:Boolean(L),anchorEl:L,onClose:()=>Z("withdraw"),action:()=>{!async function(e,t){const n={spray_card_id:e,owner_id:t};console.log(n);const a={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,i.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/workflow/spraycard/withdraw/",a).then((e=>{e.ok&&(M(!0),E(~g))}))}(n.scpid,e)},buttonText:"Withdraw the spray card?"}))),a.createElement(r.cp,{item:!0,xs:12},a.createElement(r.cp,{container:!0,justifyContent:"center",spacing:2},a.createElement(r.cp,{item:!0,xs:12},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:w,label:"Responsible Person",focused:!0,InputProps:{readOnly:!0}})))),a.createElement(r.cp,{item:!0,xs:12},a.createElement(r.cp,{container:!0,justifyContent:"center",spacing:2},a.createElement(r.cp,{item:!0,xs:12},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:O,label:"Gallons Water Rate",color:"secondary",focused:!0,InputProps:{readOnly:!0}})),Object.keys(k).map((e=>a.createElement(a.Fragment,{key:e},a.createElement(r.cp,{item:!0,xs:12},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:k[e].label,label:"Chemical "+(Number(e)+1)+"  EPA NO. | Trade Name | Cost Per unit | Purchase Date | Application Rate",color:"secondary",focused:!0,InputProps:{readOnly:!0}})),a.createElement(r.cp,{item:!0,xs:4},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:T[e],label:"Total Amount "+(Number(e)+1),color:"secondary",focused:!0,InputProps:{readOnly:!0,endAdornment:a.createElement(o.c,{position:"end"},k[e].unit)}})),a.createElement(r.cp,{item:!0,xs:4},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:x[e],label:"Total Cost "+(Number(e)+1),color:"secondary",focused:!0,InputProps:{readOnly:!0,startAdornment:a.createElement(o.c,{position:"start"},"$")}})),a.createElement(r.cp,{item:!0,xs:4},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:J[e].label,label:"Decision Support "+(Number(e)+1),color:"secondary",focused:!0,InputProps:{readOnly:!0}}))))))),a.createElement(r.cp,{item:!0,xs:12},a.createElement(r.cp,{container:!0,justifyContent:"center",spacing:2},Object.keys(W).map((e=>a.createElement(a.Fragment,{key:e},a.createElement(r.cp,{item:!0,xs:6},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:W[e].label,label:"Crop "+(Number(e)+1)+" (Variety)",color:"warning",focused:!0,InputProps:{readOnly:!0}})),a.createElement(r.cp,{item:!0,xs:6},a.createElement(l.c,{fullWidth:!0,variant:"outlined",value:A[e].label,label:"Application Target "+(Number(e)+1),color:"warning",focused:!0,InputProps:{readOnly:!0}}))))))),$.length?a.createElement(r.cp,{item:!0,xs:12},a.createElement(s.c,{multiple:!0,value:$||[],options:$||[],getOptionLabel:e=>e.label,readOnly:!0,renderInput:e=>a.createElement(l.c,d({},e,{variant:"outlined",label:"Sites",color:"success",focused:!0}))})):null),a.createElement(m,ne),a.createElement(h,ae),a.createElement(p,ee),a.createElement(p,te))}}}]);