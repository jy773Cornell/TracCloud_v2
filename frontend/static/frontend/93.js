"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[93],{9518:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(7294),r=a(6914),i=a(2206),l=a(2658),o=a(4680);function d(e){return n.createElement(i.ZP,{open:Boolean(e.anchorEl),anchorEl:e.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},n.createElement(o.Z,{sx:{p:1,maxWidth:400}},n.createElement(l.Z,{variant:"body1"},e.msg),n.createElement(r.Z,{onClick:()=>{"delete"===e.type?(e.setAnchorEl(null),e.onDeleteClicked(e.params)):"update"===e.type&&(e.setAnchorEl(null),e.onSaveClicked())},color:"primary"},"Yes"),n.createElement(r.Z,{onClick:()=>e.setAnchorEl(null),color:"secondary"},"No")))}},4311:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(7294),r=a(6447),i=a(7608),l=a(2288);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o.apply(this,arguments)}const d=n.forwardRef((function(e,t){return n.createElement(l.Z,o({elevation:6,ref:t,variant:"filled"},e))}));function c(e){const t=(t,a)=>{"clickaway"!==a&&e.setOpen(!1)};return n.createElement(r.Z,{spacing:2,sx:{width:"100%"}},n.createElement(i.Z,{open:e.open,autoHideDuration:6e3,onClose:t},(()=>{switch(e.tag){case"success":return n.createElement(d,{onClose:t,severity:"success",sx:{width:"100%"}},e.msg);case"error":return n.createElement(d,{onClose:t,severity:"error",sx:{width:"100%"}},e.msg);case"warning":return n.createElement(d,{onClose:t,severity:"warning",sx:{width:"100%"}},e.msg);default:return null}})()))}},7093:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var n=a(7294),r=a(4680),i=a(6867),l=a(6540),o=a(7957),d=a(1733),c=a(6818),s=a(4510),u=a(7794),m=a(5295),p=a(2643),h=a(5725),v=a(6694),E=a(5116),f=a(270),g=a(6914),b=a(3264),Z=a(5137);const C=(0,b.Z)(g.Z)((()=>({margin:"15px 15px",backgroundColor:Z.Z[500],"&:hover":{backgroundColor:Z.Z[700]}})));var _=a(4311),y=a(2176),w=a(6132),x=a(853),P=a(4482),O=a(7406),I=a(3306),N=a(9518),k=a(720),S=a(9925),A=a(6189),j=a(7484),$=a.n(j);function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Y.apply(this,arguments)}const D=200,M=250,T=["chemical","cost_per_unit","amount","total_cost","pur_datetime","operator","vendor"];function R(e){const{chemical:t,...a}=e;return{chemical_id:t,...a}}function U(){return n.createElement(y.D,null,n.createElement(w.S,null),n.createElement(x.M,null),n.createElement(P.L,null),n.createElement(O.Zh,null))}function G({fieldValues:e,formData:t,columns:a,addChemicalOptions:r,handleInputChange:i,showAddModal:l,setShowAddModal:o,setIsSave:d,inputError:c,updateInputError:s,refreshRecord:b,setRefreshRecord:Z}){return n.createElement(u.Z,{open:l,onClose:()=>o(!1),sx:{display:"flex",justifyContent:"center",alignItems:"center"}},n.createElement(m.Z,{sx:{width:800}},n.createElement(p.Z,null,n.createElement(h.ZP,{container:!0,justifyContent:"center",spacing:2},n.createElement(h.ZP,{item:!0,xs:12,sx:{textAlign:"center"}},n.createElement("h1",null,"Add Chemical Purchase Record")),n.createElement(h.ZP,{item:!0,xs:12},n.createElement(v.Z,{value:e[T[0]],options:r,onChange:(e,t)=>{i(e,t,T[0])},renderInput:e=>n.createElement(E.Z,Y({},e,{required:!0,variant:"outlined",placeholder:"EPA NO.  |  Trade Name  |  Active Ingredient  |  REI  |  PHI  |  Application Unit",label:"Chemical",error:c[T[0]]}))})),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(E.Z,{variant:"outlined",fullWidth:!0,required:!0,type:"number",inputProps:{step:.01},InputProps:{startAdornment:n.createElement(f.Z,{position:"start"},"$"),endAdornment:n.createElement(f.Z,{position:"end"},`per ${e.unit}`)},label:a[8].headerName,error:c[T[1]],onChange:e=>{i(e,e.target.value,T[1])}})),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(E.Z,{variant:"outlined",fullWidth:!0,required:!0,type:"number",inputProps:{step:.01},InputProps:{endAdornment:n.createElement(f.Z,{position:"end"},`${e.unit}`)},label:a[9].headerName,error:c[T[2]],onChange:e=>{i(e,e.target.value,T[2])}})),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(E.Z,{variant:"outlined",fullWidth:!0,value:e[T[3]],label:a[10].headerName,InputLabelProps:{shrink:!0,readOnly:!0},InputProps:{startAdornment:n.createElement(f.Z,{position:"start"},"$")}})),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(k._,{dateAdapter:S.y},n.createElement(A.M,{variant:"outlined",label:a[11].headerName,value:$()(e[T[4]]),onChange:e=>{i(e,$()(e).format("YYYY-MM-DD"),T[4])},sx:{width:"100%"}}))),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(E.Z,{variant:"outlined",fullWidth:!0,required:!0,label:a[12].headerName,error:c[T[5]],onChange:e=>{i(e,e.target.value,T[5])}})),n.createElement(h.ZP,{item:!0,xs:4},n.createElement(E.Z,{variant:"outlined",fullWidth:!0,required:!0,label:a[13].headerName,error:c[T[6]],onChange:e=>{i(e,e.target.value,T[6])}})),n.createElement(h.ZP,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},n.createElement(g.Z,{variant:"contained",color:"success",onClick:()=>{Object.values(e).every((e=>""!==e))?async function(){const e=R(t);console.log(e);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};await fetch("/api/operation/purchase/create/",a).then((e=>{e.ok&&(d(!0),o(!1),Z(~b))}))}():s()}},"Save")),n.createElement(h.ZP,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},n.createElement(g.Z,{variant:"contained",color:"secondary",onClick:()=>o(!1)},"Cancel"))))))}function W(e){const t=e.uid,[a,u]=(0,n.useState)([]),[m,p]=(0,n.useState)([]),[h,g]=(0,n.useState)([]),[b,Z]=(0,n.useState)({}),[y,w]=(0,n.useState)({}),[x,P]=(0,n.useState)([]),[O,j]=(0,n.useState)([]),[W,q]=(0,n.useState)(!1),[F,L]=(0,n.useState)(!1),[H,J]=(0,n.useState)(!1),[V,z]=(0,n.useState)(!1),[B,K]=(0,n.useState)([]),[Q,X]=(0,n.useState)(null),[ee,te]=(0,n.useState)(null),[ae,ne]=(0,n.useState)(null),[re,ie]=(0,n.useState)(!1);async function le(e){await fetch("/api/operation/purchase/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{u(e.data)}))}))}const oe=e=>{if("string"!=typeof e)return null;const t=e.match(/(\d+\.\d+)|(\d+)/);return t?t[0]:null},de=()=>{K(Object.fromEntries(T.map((e=>[e,!1]))))},ce=()=>{Object.keys(y).forEach((e=>{""===y[e]?K((t=>({...t,[e]:!0}))):K((t=>({...t,[e]:!1})))}))},se=()=>{if(Object.values(y).every((e=>""!==e))){!async function(){const e=R(b);console.log(e);const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};await fetch("/api/operation/purchase/update/",t).then((e=>{e.ok&&(J(!0),X(null),ie(~re))}))}();const e=h.findIndex((e=>e.id===y.id));g([...h.slice(0,e),y,...h.slice(e+1)])}else ce()},ue=e=>{!async function(e){const a={user:t,prid:e};console.log(a);const n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};await fetch("/api/operation/purchase/delete/",n).then((e=>{e.ok&&(z(!0),ie(~re))}))}(e.id);const a=h.findIndex((t=>t.id===e.id));g([...h.slice(0,a),...h.slice(a+1)])},me=(e,t,a)=>{a===T[0]?(w({...y,[a]:t,trade_name:t.trade_name,active_ingredient:t.active_ingredient,percent_ai:t.percent_ai,rei:t.rei,phi:t.phi,unit:t.unit}),Z({...b,[a]:t.id})):(w({...y,[a]:t}),Z({...b,[a]:t}))},pe=[{field:"operations",headerName:"Operations",sortable:!1,width:150,disableColumnMenu:!0,disableClickEventBubbling:!0,renderCell:e=>Q!==e.id?n.createElement(n.Fragment,null,n.createElement(i.Z,{onClick:()=>(e=>{Z({prid:e.id}),w(e.row),X(e.id),de()})(e)},n.createElement(o.Z,null)),n.createElement(i.Z,{onClick:t=>{te(t.currentTarget),ne(e.id)}},n.createElement(d.Z,null)),ae===e.id&&n.createElement(N.Z,{anchorEl:ee,setAnchorEl:te,onDeleteClicked:ue,params:e,msg:"Delete this record?",type:"delete"})):n.createElement(n.Fragment,null,n.createElement(i.Z,{onClick:t=>{te(t.currentTarget),ne(e.id)}},n.createElement(c.Z,null)),n.createElement(i.Z,{onClick:()=>(X(null),void de())},n.createElement(s.Z,null)),ae===e.id&&n.createElement(N.Z,{anchorEl:ee,setAnchorEl:te,onSaveClicked:se,params:e,msg:"Update this record?",type:"update"}))},{field:"chemical",headerName:"EPA Registration No.",sortable:!1,width:M,renderCell:(e,t=e.id)=>n.createElement(v.Z,{options:O,disableClearable:!0,readOnly:Q!==t,value:Q===t?y[T[0]]:e.value,onChange:(e,t)=>{me(0,t,T[0])},renderInput:e=>Q!==t?n.createElement(E.Z,Y({},e,{variant:"standard",InputProps:{disableUnderline:!0},sx:{width:M}})):n.createElement(E.Z,Y({},e,{variant:"standard",sx:{width:M-20},error:B[T[0]]}))})},{field:"trade_name",headerName:"Trade Name",sortable:!1,width:M,valueGetter:e=>Q===e.id?y.trade_name:e.value},{field:"active_ingredient",headerName:"Active Ingredient",sortable:!1,width:M,valueGetter:e=>Q===e.id?y.active_ingredient:e.value},{field:"percent_ai",headerName:"Active Ingredient Percent",sortable:!1,width:M,valueGetter:e=>Q===e.id?y.percent_ai:e.value},{field:"rei",headerName:"REI",sortable:!1,width:D,valueGetter:e=>Q===e.id?y.rei:e.value},{field:"phi",headerName:"PHI",sortable:!1,width:D,valueGetter:e=>Q===e.id?y.phi:e.value},{field:"unit",headerName:"Unit",sortable:!1,width:D,valueGetter:e=>Q===e.id?y.unit:e.value},{field:"cost_per_unit",headerName:"Cost Per Unit",sortable:!1,width:D,renderCell:(e,t=e.id)=>Q!==t?n.createElement(E.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):n.createElement(n.Fragment,null,n.createElement(E.Z,{variant:"standard",value:oe(y[T[1]]),type:"number",inputProps:{step:.01},InputProps:{startAdornment:n.createElement(f.Z,{position:"start"},"$")},sx:{width:D/2},onChange:e=>{me(0,e.target.value,T[1])},error:B[T[1]]}),n.createElement(E.Z,{variant:"standard",value:`per ${y.unit}`,sx:{width:D/2},InputLabelProps:{readOnly:!0}}))},{field:"amount",headerName:"Amount",sortable:!1,width:D,renderCell:(e,t=e.id)=>Q!==t?n.createElement(E.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):n.createElement(n.Fragment,null,n.createElement(E.Z,{variant:"standard",value:oe(y[T[2]]),type:"number",inputProps:{step:.01},sx:{width:D/2},onChange:e=>{me(0,e.target.value,T[2])},error:B[T[2]]}),n.createElement(E.Z,{variant:"standard",value:`${y.unit}`,sx:{width:D/2},InputLabelProps:{readOnly:!0}}))},{field:"total_cost",headerName:"Total Cost",sortable:!1,width:D,valueGetter:e=>Q===e.id?`$${y[T[3]]}`:e.value},{field:"pur_datetime",headerName:"Purchase Datetime",sortable:!1,width:D,renderCell:(e,t=e.id)=>Q!==t?n.createElement(E.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):n.createElement(k._,{dateAdapter:S.y},n.createElement(A.M,{variant:"standard",value:$()(y[T[4]]),sx:{width:D},slotProps:{textField:{variant:"standard"}},onChange:e=>{me(0,$()(e).format("YYYY-MM-DD"),T[4])}}))},{field:"operator",headerName:"Operator",sortable:!1,width:D,renderCell:(e,t=e.id)=>Q!==t?n.createElement(E.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):n.createElement(E.Z,{variant:"standard",value:y[T[5]],sx:{width:D},onChange:e=>{me(0,e.target.value,T[5])},error:B[T[5]]})},{field:"vendor",headerName:"Vendor",sortable:!1,width:D,renderCell:(e,t=e.id)=>Q!==t?n.createElement(E.Z,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):n.createElement(E.Z,{variant:"standard",value:y[T[6]],sx:{width:D},onChange:e=>{me(0,e.target.value,T[6])},error:B[T[6]]})},{field:"update_time",headerName:"Update Time",sortable:!1,width:D}],he={fieldValues:y,formData:b,columns:pe,addChemicalOptions:x,handleInputChange:me,showAddModal:F,setShowAddModal:L,setIsSave:J,inputError:B,updateInputError:ce,refreshRecord:re,setRefreshRecord:ie},ve={open:H,setOpen:J,msg:"Purchase record is uploaded successfully!",tag:"success"},Ee={open:V,setOpen:z,msg:"Purchase record has been deleted!",tag:"success"};return(0,n.useEffect)((()=>{(async()=>{await async function(e){await fetch("/api/chemical/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{p(e.data)}))}))}(t),await le(t)})(),de(),q(!0)}),[]),(0,n.useEffect)((()=>{P(m.map((e=>({label:`${e.epa_reg_no}  |  ${e.trade_name}  |  ${e.active_ingredient}  |  ${e.rei}  |  ${e.phi}  |  ${e.unit}`,trade_name:e.trade_name,active_ingredient:e.active_ingredient,percent_ai:e.percent_ai,rei:e.rei,phi:e.phi,unit:e.unit,id:e.chemid})))),j(m.map((e=>({label:e.epa_reg_no,trade_name:e.trade_name,active_ingredient:e.active_ingredient,percent_ai:e.percent_ai,rei:e.rei,phi:e.phi,unit:e.unit,id:e.chemid}))))}),[m]),(0,n.useEffect)((()=>{g(a.map((e=>(e=>{const t=m.find((t=>t.chemid===e.chemical));return{id:e.prid,chemical:t.epa_reg_no,trade_name:t.trade_name,active_ingredient:t.active_ingredient,percent_ai:t.percent_ai,rei:t.rei,phi:t.phi,unit:t.unit,cost_per_unit:`$${e.cost_per_unit} per ${t.unit}`,amount:`${e.amount} ${t.unit}`,total_cost:`$${e.total_cost}`,pur_datetime:e.pur_datetime,operator:e.operator,vendor:e.vendor,update_time:e.update_time}})(e))))}),[a]),(0,n.useEffect)((()=>{W&&le(t)}),[re]),(0,n.useEffect)((()=>{const e=oe(y[T[1]]),t=oe(y[T[2]]);if(e&&t){const a=Number(e)*Number(t);w({...y,[T[3]]:a}),Z({...b,[T[3]]:a})}}),[y[T[1]],y[T[2]]]),n.createElement("div",null,n.createElement(C,{variant:"contained",startIcon:n.createElement(l.Z,null),onClick:()=>(Z({user_id:t,[T[4]]:$()().format("YYYY-MM-DD")}),w(Object.fromEntries(T.map(((e,t)=>[e,4===t?$()().format("YYYY-MM-DD"):""])))),w((e=>({...e,unit:""}))),X(null),L(!0),void de())},"Add Purchase Record"),n.createElement(r.Z,{style:{height:900,margin:"0px 15px"}},n.createElement(I._,{columns:pe,rows:h,disableRowSelectionOnClick:!0,disableClickEdit:!0,rowSelection:!1,slots:{toolbar:U}})),n.createElement(G,he),n.createElement(_.Z,ve),n.createElement(_.Z,Ee))}}}]);