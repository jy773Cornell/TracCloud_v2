"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2752],{9700:(e,t,n)=>{var a=n(7649);t.c=void 0;var r=a(n(3540)),i=n(7624),l=(0,r.default)((0,i.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.c=l},7516:(e,t,n)=>{n.d(t,{c:()=>b});var a=n(5072),r=n(5656),i=n(1504),l=n(3268),c=n.n(l),o=n(4971),d=n(4048),s=n(5664),u=n(6940),m=n(440),p=n(6968),h=n(7100),v=n(1272);function f(e){return(0,v.c)("MuiCard",e)}(0,h.c)("MuiCard",["root"]);var E=n(7624);const g=["className","raised"],y=(0,u.cp)(p.c,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),C=i.forwardRef((function(e,t){const n=(0,m.c)({props:e,name:"MuiCard"}),{className:i,raised:l=!1}=n,c=(0,r.c)(n,g),d=(0,a.c)({},n,{raised:l}),u=(e=>{const{classes:t}=e;return(0,s.c)({root:["root"]},f,t)})(d);return(0,E.jsx)(y,(0,a.c)({className:(0,o.c)(u.root,i),elevation:l?8:void 0,ref:t,ownerState:d},c))}));C.propTypes={children:c().node,classes:c().object,className:c().string,raised:(0,d.c)(c().bool,(e=>e.raised&&"outlined"===e.variant?new Error('MUI: Combining `raised={true}` with `variant="outlined"` has no effect.'):null)),sx:c().oneOfType([c().arrayOf(c().oneOfType([c().func,c().object,c().bool])),c().func,c().object])};const b=C},2060:(e,t,n)=>{n.d(t,{c:()=>o});var a=n(1504),r=n(1940),i=n(6864),l=n(8857),c=n(6968);function o(e){return a.createElement(i.cp,{open:Boolean(e.anchorEl),anchorEl:e.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},a.createElement(c.c,{sx:{p:1,maxWidth:400}},a.createElement(l.c,{variant:"body1"},e.msg),a.createElement(r.c,{onClick:()=>{"delete"===e.type?(e.setAnchorEl(null),e.onDeleteClicked(e.params)):"update"===e.type&&(e.setAnchorEl(null),e.onSaveClicked())},color:"primary"},"Yes"),a.createElement(r.c,{onClick:()=>e.setAnchorEl(null),color:"secondary"},"No")))}},7600:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(1504),r=n(6988),i=n(6350),l=n(4408);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c.apply(this,arguments)}const o=a.forwardRef((function(e,t){return a.createElement(l.c,c({elevation:6,ref:t,variant:"filled"},e))}));function d(e){const t=(t,n)=>{"clickaway"!==n&&e.setOpen(!1)};return a.createElement(r.c,{spacing:2,sx:{width:"100%"}},a.createElement(i.c,{open:e.open,autoHideDuration:6e3,onClose:t},(()=>{switch(e.tag){case"success":return a.createElement(o,{onClose:t,severity:"success",sx:{width:"100%"}},e.msg);case"error":return a.createElement(o,{onClose:t,severity:"error",sx:{width:"100%"}},e.msg);case"warning":return a.createElement(o,{onClose:t,severity:"warning",sx:{width:"100%"}},e.msg);default:return null}})()))}},372:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var a=n(1504),r=n(6968),i=n(3562),l=n(3704),c=n(3683),o=n(9700),d=n(108),s=n(8880),u=n(5984),m=n(7516),p=n(4477),h=n(3964),v=n(4660),f=n(3604),E=n(3184),g=n(1940),y=n(6060),C=n(3628);const b=(0,y.c)(g.c)((()=>({margin:"15px 15px",backgroundColor:C.c[500],"&:hover":{backgroundColor:C.c[700]}})));var w=n(7600),_=n(3083),x=n(8604),O=n(8388),k=n(4024),N=n(5466),S=n(9440),I=n(2060),P=n(3144),A=n(7500),j=n(768),$=n(2264),T=n.n($),M=n(2528);function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},R.apply(this,arguments)}const D=200,Y=250,U=300,F=["pur_datetime","amount","total_cost","cost_per_unit","chemical","note"];function G(e){const{chemical:t,...n}=e;return{chemical_id:t,...n}}function q(){return a.createElement(_.q,null,a.createElement(x.S,null),a.createElement(O.e,null),a.createElement(k.a,null),a.createElement(N.Wc,null))}function H({fieldValues:e,formData:t,columns:n,addChemicalOptions:r,handleInputChange:i,showAddModal:l,setShowAddModal:c,setIsSave:o,inputError:d,updateInputError:s,refreshRecord:y,setRefreshRecord:C}){return a.createElement(u.c,{open:l,sx:{display:"flex",justifyContent:"center",alignItems:"center"}},a.createElement(m.c,{sx:{width:800}},a.createElement(p.c,null,a.createElement(h.cp,{container:!0,justifyContent:"center",spacing:2},a.createElement(h.cp,{item:!0,xs:12,sx:{textAlign:"center"}},a.createElement("h1",null,"Add Chemical Purchase Record")),a.createElement(h.cp,{item:!0,xs:12},a.createElement(v.c,{value:e[F[4]],options:r||[],onChange:(e,t)=>{i(e,t,F[4])},renderInput:e=>a.createElement(f.c,R({},e,{required:!0,variant:"outlined",placeholder:"EPA NO.  |  Trade Name  |  Active Ingredient  |  REI  |  PHI  |  Applied Unit",label:"Chemical",error:d[F[4]]}))})),a.createElement(h.cp,{item:!0,xs:6},a.createElement(P.c,{dateAdapter:A.q},a.createElement(j.I,{variant:"outlined",label:n[1].headerName,value:T()(e[F[0]]),onChange:e=>{i(e,T()(e).format("YYYY-MM-DD"),F[0])},sx:{width:"100%"}}))),a.createElement(h.cp,{item:!0,xs:6},a.createElement(f.c,{variant:"outlined",fullWidth:!0,required:!0,type:"number",inputProps:{step:.01},InputProps:{endAdornment:a.createElement(E.c,{position:"end"},`${e.unit}`)},label:n[3].headerName,error:d[F[1]],onChange:e=>{i(e,e.target.value,F[1])}})),a.createElement(h.cp,{item:!0,xs:6},a.createElement(f.c,{variant:"outlined",fullWidth:!0,required:!0,label:n[4].headerName,type:"number",inputProps:{step:.01},InputProps:{startAdornment:a.createElement(E.c,{position:"start"},"$")},error:d[F[2]],onChange:e=>{i(e,e.target.value,F[2])}})),a.createElement(h.cp,{item:!0,xs:6},a.createElement(f.c,{value:e[F[3]],variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0,readOnly:!0},InputProps:{startAdornment:a.createElement(E.c,{position:"start"},"$"),endAdornment:a.createElement(E.c,{position:"end"},`per ${e.unit}`)},label:n[5].headerName})),a.createElement(h.cp,{item:!0,xs:12},a.createElement(f.c,{variant:"outlined",multiline:!0,fullWidth:!0,label:n[11].headerName,onChange:e=>{i(e,e.target.value,F[5])}})),a.createElement(h.cp,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},a.createElement(g.c,{variant:"contained",color:"secondary",onClick:()=>c(!1)},"Cancel")),a.createElement(h.cp,{item:!0,xs:6,sx:{justifyContent:"center",textAlign:"center"}},a.createElement(g.c,{variant:"contained",color:"success",onClick:()=>{Object.values(e).slice(0,4).every((e=>""!==e))?async function(){const e=G(t);console.log(e);const n={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":(0,M.U$)("csrftoken")},body:JSON.stringify(e)};await fetch("/api/operation/purchase/create/",n).then((e=>{e.ok&&(o(!0),c(!1),C(~y))}))}():s()}},"Save"))))))}function W(e){e.uid;const t=e.employerID,n=e.privilege,[u,m]=(0,a.useState)([]),[p,h]=(0,a.useState)([]),[g,y]=(0,a.useState)([]),[C,_]=(0,a.useState)({}),[x,O]=(0,a.useState)({}),[k,N]=(0,a.useState)([]),[$,W]=(0,a.useState)([]),[z,V]=(0,a.useState)(!1),[J,L]=(0,a.useState)(!1),[X,B]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)([]),[te,ne]=(0,a.useState)(null),[ae,re]=(0,a.useState)(null),[ie,le]=(0,a.useState)(null),[ce,oe]=(0,a.useState)(!1);async function de(e){n.purchase_r&&await fetch("/api/operation/purchase/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{m(e.data)}))}))}const se=e=>{if("string"!=typeof e)return null;const t=e.match(/(\d+\.\d+)|(\d+)/);return t?t[0]:null},ue=()=>{ee(Object.fromEntries(F.map((e=>[e,!1]))))},me=()=>{Object.keys(x).forEach((e=>{""===x[e]?ee((t=>({...t,[e]:!0}))):ee((t=>({...t,[e]:!1})))}))},pe=()=>{if(Object.entries(x).every((([e,t])=>e===F[5]||""!==t))){!async function(){const e=G(C);console.log(e);const t={method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":(0,M.U$)("csrftoken")},body:JSON.stringify(e)};await fetch("/api/operation/purchase/update/",t).then((e=>{e.ok&&(B(!0),ne(null),oe(~ce))}))}();const e=g.findIndex((e=>e.id===x.id));y([...g.slice(0,e),x,...g.slice(e+1)])}else me()},he=e=>{!async function(e){const n={user_id:t,prid:e};console.log(n);const a={method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":(0,M.U$)("csrftoken")},body:JSON.stringify(n)};await fetch("/api/operation/purchase/delete/",a).then((e=>{e.ok&&(Q(!0),oe(~ce))}))}(e.id);const n=g.findIndex((t=>t.id===e.id));y([...g.slice(0,n),...g.slice(n+1)])},ve=(e,t,n)=>{n===F[4]?(O({...x,[n]:t,trade_name:t.trade_name,active_ingredient:t.active_ingredient,rei:t.rei,phi:t.phi,company:t.company,unit:t.unit}),_({...C,[n]:t.id})):(O({...x,[n]:t}),_({...C,[n]:t}))},fe=[{field:"operations",headerName:"Operations",sortable:!1,width:150,disableColumnMenu:!0,disableClickEventBubbling:!0,renderCell:e=>te!==e.id?a.createElement(a.Fragment,null,a.createElement(i.c,{onClick:()=>(e=>{_({prid:e.id}),O(e.row),ne(e.id),ue()})(e),disabled:!n.purchase_u},a.createElement(c.c,null)),a.createElement(i.c,{onClick:t=>{re(t.currentTarget),le(e.id)},disabled:!n.purchase_d},a.createElement(o.c,null)),ie===e.id&&a.createElement(I.c,{anchorEl:ae,setAnchorEl:re,onDeleteClicked:he,params:e,msg:"Delete this record?",type:"delete"})):a.createElement(a.Fragment,null,a.createElement(i.c,{onClick:()=>(ne(null),void ue())},a.createElement(s.c,null)),a.createElement(i.c,{onClick:t=>{re(t.currentTarget),le(e.id)}},a.createElement(d.c,null)),ie===e.id&&a.createElement(I.c,{anchorEl:ae,setAnchorEl:re,onSaveClicked:pe,params:e,msg:"Update this record?",type:"update"}))},{field:"pur_datetime",headerName:"Date Purchased",width:D,renderCell:(e,t=e.id)=>te!==t?a.createElement(f.c,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):a.createElement(P.c,{dateAdapter:A.q},a.createElement(j.I,{variant:"standard",value:T()(x[F[0]]),sx:{width:D},slotProps:{textField:{variant:"standard"}},onChange:e=>{ve(0,T()(e).format("YYYY-MM-DD"),F[0])}}))},{field:"trade_name",headerName:"Trade Name",width:Y,valueGetter:e=>te===e.id?x.trade_name:e.value},{field:"amount",headerName:"Amount Purchased",width:D,renderCell:(e,t=e.id)=>te!==t?a.createElement(f.c,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):a.createElement(a.Fragment,null,a.createElement(f.c,{variant:"standard",value:se(x[F[1]]),type:"number",inputProps:{step:.01},sx:{width:D/2},onChange:e=>{ve(0,e.target.value,F[1])},error:Z[F[1]]}),a.createElement(f.c,{variant:"standard",value:`${x.unit}`,sx:{width:D/2},InputLabelProps:{readOnly:!0}}))},{field:"total_cost",headerName:"Total Cost",width:D,renderCell:(e,t=e.id)=>te!==t?a.createElement(f.c,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:D}}):a.createElement(a.Fragment,null,a.createElement(f.c,{variant:"standard",value:se(x[F[2]]),type:"number",inputProps:{step:.01},InputProps:{startAdornment:a.createElement(E.c,{position:"start"},"$")},sx:{width:D},onChange:e=>{ve(0,e.target.value,F[2])},error:Z[F[2]]}))},{field:"cost_per_unit",headerName:"Cost Per Applied Unit",width:D,valueGetter:e=>te===e.id?`${x[F[3]]} per ${x.unit}`:e.value},{field:"chemical",headerName:"EPA REG NO.",width:Y,renderCell:(e,t=e.id)=>a.createElement(v.c,{options:$||[],disableClearable:!0,readOnly:te!==t,value:te===t?x[F[4]]:e.value,onChange:(e,t)=>{ve(0,t,F[4])},renderInput:e=>te!==t?a.createElement(f.c,R({},e,{variant:"standard",InputProps:{disableUnderline:!0},sx:{width:Y}})):a.createElement(f.c,R({},e,{variant:"standard",sx:{width:Y-20},error:Z[F[4]]}))})},{field:"active_ingredient",headerName:"Active Ingredient",width:Y,valueGetter:e=>te===e.id?x.active_ingredient:e.value},{field:"rei",headerName:"REI-Hrs",width:D,valueGetter:e=>te===e.id?x.rei:e.value},{field:"phi",headerName:"PHI-Days",width:D,valueGetter:e=>te===e.id?x.phi:e.value},{field:"company",headerName:"Company",width:D,valueGetter:e=>te===e.id?x.company:e.value},{field:"note",headerName:"Note",width:U,renderCell:(e,t=e.id)=>te!==t?a.createElement(f.c,{variant:"standard",value:e.value,InputProps:{disableUnderline:!0,readOnly:!0},sx:{width:U}}):a.createElement(f.c,{variant:"standard",value:x[F[5]],sx:{width:D},onChange:e=>{ve(0,e.target.value,F[5])}})},{field:"update_time",headerName:"Update Time",width:D}],Ee={fieldValues:x,formData:C,columns:fe,addChemicalOptions:k,handleInputChange:ve,showAddModal:J,setShowAddModal:L,setIsSave:B,inputError:Z,updateInputError:me,refreshRecord:ce,setRefreshRecord:oe},ge={open:X,setOpen:B,msg:"Purchase record is uploaded successfully!",tag:"success"},ye={open:K,setOpen:Q,msg:"Purchase record has been deleted!",tag:"success"};return(0,a.useEffect)((()=>{(async()=>{await async function(e){await fetch("/api/chemical/list/get/?uid="+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>{e.ok&&e.json().then((e=>{h(e.data)}))}))}(t),await de(t)})(),ue(),V(!0)}),[]),(0,a.useEffect)((()=>{N(p.map((e=>({label:`${e.epa_reg_no}  |  ${e.trade_name}  |  ${e.active_ingredient}  |  ${e.rei} hours  |  ${e.phi} days  |  ${e.unit}`,trade_name:e.trade_name,active_ingredient:e.active_ingredient,percent_ai:e.percent_ai,rei:e.rei,phi:e.phi,unit:e.unit,id:e.chemid})))),W(p.map((e=>({label:e.epa_reg_no,trade_name:e.trade_name,active_ingredient:e.active_ingredient,percent_ai:e.percent_ai,rei:e.rei,phi:e.phi,unit:e.unit,id:e.chemid}))))}),[p]),(0,a.useEffect)((()=>{y(u.map((e=>(e=>{for(let t in e)null===e[t]&&(e[t]="");const t=p.find((t=>t.chemid===e.chemical));return{id:e.prid,pur_datetime:e.pur_datetime,trade_name:t.trade_name,amount:`${e.amount} ${t.unit}`,total_cost:`$${e.total_cost}`,cost_per_unit:`$${e.cost_per_unit} per ${t.unit}`,chemical:t.epa_reg_no,active_ingredient:t.active_ingredient,rei:t.rei,phi:t.phi,company:t.company,unit:t.unit,note:e.note,update_time:e.update_time}})(e))))}),[u]),(0,a.useEffect)((()=>{z&&de(t)}),[ce]),(0,a.useEffect)((()=>{const e=se(x[F[1]]),t=se(x[F[2]]);if(e&&t){const n=(Number(t)/Number(e)).toFixed(2);O({...x,[F[3]]:n}),_({...C,[F[3]]:n})}}),[x[F[1]],x[F[2]]]),a.createElement("div",null,a.createElement(b,{variant:"contained",startIcon:a.createElement(l.c,null),onClick:()=>(_({user_id:t,[F[0]]:T()().format("YYYY-MM-DD")}),O(Object.fromEntries(F.map(((e,t)=>[e,0===t?T()().format("YYYY-MM-DD"):""])))),O((e=>({...e,unit:""}))),ne(null),L(!0),void ue()),disabled:!n.purchase_c},"Add Purchase Record"),a.createElement(r.c,{style:{height:900,margin:"0px 15px",width:"calc(100% - 30px)",overflow:"auto"}},a.createElement(S.o,{columns:fe,rows:g,disableRowSelectionOnClick:!0,disableClickEdit:!0,rowSelection:!1,slots:{toolbar:q},localeText:{noRowsLabel:n.purchase_r?"No rows":"You don't have the privilege to access this data"}})),a.createElement(H,Ee),a.createElement(w.default,ge),a.createElement(w.default,ye))}}}]);